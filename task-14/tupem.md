# Задача о коммивояжере (Генетический алгоритм)

Есть N городов, связанных дорогами. Расстояния между городами известны. Коммивояжер (бродячий торговец) должен выйти из первого города, посетить по одному разу в некотором порядке города 2,3..n и вернуться в первый город. В каком порядке следует посещать города, чтобы замкнутый путь коммивояжера имел кратчайшее расстояние?

### Вариант 1:

1. Сгенерировать 2 особи (случайных решения) в виде перестановки номеров городов, которая всегда начинается с единицы.
2. Рассчитать фитнес-функцию для особей.
3. Закодировать их с применением альтернативной кодировки с пошаговыми комментариями.
4. Провести одноточечное скрещивание особей с пошаговыми комментариями, получить два потомка.
5. Провести мутацию одного из потомков с пошаговыми комментариями.
6. Декодировать альтернативную кодировку потомков в натуральную кодировку с пошаговыми комментариями.
7. Рассчитать фитнес-функцию для потомков.

--------------------------

### Имеется матрица расстояний:

|     | **1**  | **2**  | **3**  | **4**  | **5**  |
|-----|--------|--------|--------|--------|--------|
| **1** | -    | 7      | 3      | 8      | 2      |
| **2** | 7    | -      | 6      | 4      | 9      |
| **3** | 3    | 6      | -      | 5      | 1      |
| **4** | 8    | 4      | 5      | -      | 2      |
| **5** | 2    | 9      | 1      | 2      | -      |

$x_1$ 15342  $\rightarrow$ $f(x_1) = 2 + 1 + 5 + 4 + 7 = 19$

$x_2$ 14532 $\rightarrow$ $f(x_2) = 8 + 2 + 1 + 6 + 7 = 24$

### Альтернативная кодировка первой особи

| **$x_1$**             |       |       |       |       |       |       |
|---------------------|-------|-------|-------|-------|-------|-------|
| **Натуральный код** |       | 1     | 5     | 3     | 4     | 2     |
| **Возрастающая перестановка** |       | 1     | 2     | 3     | 4     | 5     |
| **Номера возрастающей перестановки**|       | 1     | 2     | 3     | 4     | 5     |

Ген 1 в возрастающей перестановке находится под номером 1. В альтернативный код записываем 1.

Альтернативный код: 1

| **$x_1$**           |       |       |       |       |       |       
|---------------------|-------|-------|-------|-------|-------|
| **Натуральный код** |       | 5     | 3     | 4     | 2     |
|**Возрастающая перестановка**|       |  2    | 3     | 4    | 5     |
| **Номера возрастающей перестановки**|| 1    | 2     | 3    | 4     | 

Ген 5 в возрастающей перестановке находится под номером 4. В альтернативный код записываем 4.

Альтернативный код: 14

| **$x_1$**           |       |       |       |       |     
|---------------------|-------|-------|-------|-------|
| **Натуральный код** |       | 3     | 4     | 2     |
|**Возрастающая перестановка**|       |  2    | 3    | 4     |
| **Номера возрастающей перестановки**|| 1    | 2     | 3     |

Ген 3 в возрастающей перестановке находится под номером 2. В альтернативный код записываем 2.

Альтернативный код: 142

| **$x_1$**           |       |       |       |  
|---------------------|-------|-------|-------|
| **Натуральный код** |       | 4     | 2     |
|**Возрастающая перестановка**|       |  2    | 4     |
| **Номера возрастающей перестановки**|| 1    | 2     |

Ген 4 в возрастающей перестановке находится под номером 2. В альтернативный код записываем 2.

Альтернативный код: 1422

| **$x_1$**           |       |       |
|---------------------|-------|-------|
| **Натуральный код** |       | 2     |
|**Возрастающая перестановка**|       |  2    |
| **Номера возрастающей перестановки**|| 1    |

Ген 2 в возрастающей перестановке находится под номером 1. В альтернативный код записываем 1.

Альтернативный код: 14221

| **Натуральный код $x_1$** |       | 1     | 5     | 3     | 4     | 2     |
|---------------------|-------|-----|-------|-------|-------|-------|
|**Альтернативный код $x_1$**|      | 1     | 4     | 2     | 2     | 1     |

### Альтернативная кодировка второй особи

$x_2$ 14532 

| **$x_2$**             |       |       |       |       |       |       |
|---------------------|-------|-------|-------|-------|-------|-------|
| **Натуральный код** |       | 1     | 4     | 5     | 3     | 2     |
| **Возрастающая перестановка** |       | 1     | 2     | 3     | 4     | 5     |
| **Номера возрастающей перестановки**|       | 1     | 2     | 3     | 4     | 5     |

Ген 1 в возрастающей перестановке находится под номером 1. В альтернативный код записываем 1.

Альтернативный код: 1

| **$x_2$**           |       |       |       |       |       |       
|---------------------|-------|-------|-------|-------|-------|
| **Натуральный код** |       | 4     | 5     | 3     | 2     |
|**Возрастающая перестановка**|       |  2    | 3     | 4    | 5     |
| **Номера возрастающей перестановки**|| 1    | 2     | 3    | 4     | 

Ген 4 в возрастающей перестановке находится под номером 3. В альтернативный код записываем 3.

Альтернативный код: 13

| **$x_2$**           |       |       |       |       |     
|---------------------|-------|-------|-------|-------|
| **Натуральный код** |       | 5     | 3     | 2     |
|**Возрастающая перестановка**|       |  2    | 3     | 5    |
| **Номера возрастающей перестановки**|| 1    | 2     | 3    |

Ген 5 в возрастающей перестановке находится под номером 3. В альтернативный код записываем 3.

Альтернативный код: 133

| **$x_2$**           |       |       |       | 
|---------------------|-------|-------|-------|
| **Натуральный код** |       | 3     | 2     |
|**Возрастающая перестановка**|       |  2    | 3     |
| **Номера возрастающей перестановки**|| 1    | 2     | 

Ген 3 в возрастающей перестановке находится под номером 2. В альтернативный код записываем 2.

Альтернативный код: 1332

| **$x_2$**           |       |       |      
|---------------------|-------|-------|
| **Натуральный код** |       | 2     |
|**Возрастающая перестановка**|       |  2    |
| **Номера возрастающей перестановки**|| 1    | 

Ген 2 в возрастающей перестановке находится под номером 1. В альтернативный код записываем 1.

Альтернативный код: 13321

| **Натуральный код $x_2$** |       |  1    | 4     | 5     | 3     | 2     |
|---------------------|-------|-----|-------|-------|-------|-------|
|**Альтернативный код $x_2$**|      | 1     | 3     | 3     | 2     | 1     |

### Одноточечное скрещивание

Случайно выберем точку скрещивания между вторым и третьим генами.

$x_1$ 14 | 221

$x_2$ 13 | 321

Особь $x_3$ берёт левую часть от $x_1$ и правую часть от $x_2$:  $x_3 = 14 + 321 = 14321$ 

Особь $x_4$ берёт левую часть от $x_2$ и правую часть от $x_1$:  $x_4 = 13 + 221 = 13221 $

Получим две новые особи:

$x_3$ 14321

$x_4$ 13221

### Мутация 

Проведем мутацию первого потомка $-$ $x_3$

Случайно выберем ген для мутации $-$ четвертый. Четвертый ген может быть закодирован числом от 1 до 2. Изменим его на 1. Получим $x_3$ 14311

### Альтернативная кодировка первого потомка $x_3$

Альтернативный код: 14311


| **$x_3$**             |       |       |       |       |       |       |
|---------------------|-------|-------|-------|-------|-------|-------|
| **Альтернативный код** |       | 1     | 4     | 3     | 1     | 1     |
| **Возрастающая перестановка** |       | 1     | 2     | 3     | 4     | 5     |
| **Номера возрастающей перестановки**| | 1     | 2     | 3     | 4     | 5     |

В возрастающей перестановке на 1й позиции стоит ген 1. Записываем 1 в натуральный код.

Натуральный код: 1

| **$x_3$**             |       |       |       |       |       |     
|---------------------|-------|-------|-------|-------|-------|
| **Альтернативный код** |       | 4    | 3     | 1    | 1    |
| **Возрастающая перестановка** |       |  2    | 3    | 4    | 5     |
| **Номера возрастающей перестановки**| |  1    | 2    | 3    | 4     | 

В возрастающей перестановке на 4й позиции стоит ген 5. Записываем 5 в натуральный код.

Натуральный код: 15

| **$x_3$**             |       |       |       |       |          
|---------------------|-------|-------|-------|-------|
| **Альтернативный код** |      | 3     | 1    | 1    |
| **Возрастающая перестановка** |       |  2    | 3    | 4    | 
| **Номера возрастающей перестановки**| |  1    | 2    | 3    |

В возрастающей перестановке на 3й позиции стоит ген 4. Записываем 4 в натуральный код.

Натуральный код: 154

| **$x_3$**             |       |       |       |              
|---------------------|-------|-------|-------|
| **Альтернативный код** |      | 1    | 1    |
| **Возрастающая перестановка** |       |  2    | 3    |
| **Номера возрастающей перестановки**| |  1    | 2    |

В возрастающей перестановке на 1й позиции стоит ген 2. Записываем 2 в натуральный код.

Натуральный код: 1542

| **$x_3$**             |       |       |                    
|---------------------|-------|-------|
| **Альтернативный код** |      | 1    | 
| **Возрастающая перестановка** |       |  3    |
| **Номера возрастающей перестановки**| |  1    | 

В возрастающей перестановке на 4й позиции стоит ген 3. Записываем 3 в натуральный код.

Натуральный код: 15423

### Альтернативная кодировка второго потомка $x_4$

Альтернативный код: 13221

| **$x_4$**           |       |       |       |       |       |       |
|---------------------|-------|-------|-------|-------|-------|-------|
| **Альтернативный код** |      | 1     | 3     | 2     | 2     | 1     |
| **Возрастающая перестановка** |       | 1     | 2     | 3     | 4     | 5     |
| **Номера возрастающей перестановки**| | 1     | 2     | 3     | 4     | 5     |

В возрастающей перестановке на 1й позиции стоит ген 1. Записываем 1 в натуральный код.

Натуральный код: 1

| **$x_4$**           |       |       |       |       |       |       
|---------------------|-------|-------|-------|-------|-------|
| **Альтернативный код** |      | 3     | 2     | 2     | 1     |
| **Возрастающая перестановка** |       |  2    | 3     | 4     | 5     |
| **Номера возрастающей перестановки**| | 1     | 2     | 3     | 4     |

В возрастающей перестановке на 3й позиции стоит ген 4. Записываем 4 в натуральный код.

Натуральный код: 14

| **$x_4$**           |       |       |       |       |             
|---------------------|-------|-------|-------|-------|
| **Альтернативный код** |      | 2     | 2     | 1     |
| **Возрастающая перестановка** |       |  2    | 3     | 5     |
| **Номера возрастающей перестановки**| | 1     | 2     | 3     | 

В возрастающей перестановке на 2й позиции стоит ген 3. Записываем 3 в натуральный код.

Натуральный код: 143

| **$x_4$**           |       |       |       |       
|---------------------|-------|-------|-------|
| **Альтернативный код** |      | 2     | 1     |
| **Возрастающая перестановка** |       |  2    | 5     |
| **Номера возрастающей перестановки**| | 1     | 2     |

В возрастающей перестановке на 2й позиции стоит ген 5. Записываем 5 в натуральный код.

Натуральный код: 1435

| **$x_4$**           |       |       |       |       
|---------------------|-------|-------|-------|
| **Альтернативный код** |      | 1     |
| **Возрастающая перестановка** |       |  2    | 
| **Номера возрастающей перестановки**| | 1     | 

В возрастающей перестановке на 1й позиции стоит ген 2. Записываем 2 в натуральный код.

Натуральный код: 14352 

### Фитнес-функции для потомков


|     | **1**  | **2**  | **3**  | **4**  | **5**  |
|-----|--------|--------|--------|--------|--------|
| **1** | -    | 7      | 3      | 8      | 2      |
| **2** | 7    | -      | 6      | 4      | 9      |
| **3** | 3    | 6      | -      | 5      | 1      |
| **4** | 8    | 4      | 5      | -      | 2      |
| **5** | 2    | 9      | 1      | 2      | -      |

$x_1$ 15342   

$x_2$ 14532 

$x_3$ 15423

$x_4$ 14352 

$f(x_1) = 2 + 1 + 5 + 4 + 7 = 19$

$f(x_2) = 8 + 2 + 1 + 6 + 7 = 24$

$f(x_3) = 2 + 2 + 4 + 6 + 3 = 17$

$f(x_4) = 8 + 5 + 1 + 9 + 7 = 30$

Наиболее приспособленная особь $-$ $x_3$. Длина задаваемого ею маршрута равна 17.

Результатом работы алгоритма является маршрут $1 \rightarrow 5 \rightarrow 4 \rightarrow 2 \rightarrow 3 \rightarrow 1$