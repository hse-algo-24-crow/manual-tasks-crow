# Задание №14
# Задача о коммивояжере (Генетический алгоритм) 

## Постановка задачи
Задача о рюкзаке (англ. Knapsack problem) — дано N предметов, n<sub>i</sub> предмет имеет массу w<sub>i</sub> > 0 и стоимость p<sub>i</sub> > 0. Необходимо выбрать из этих предметов такой набор, чтобы суммарная масса не превосходила заданной величины W (вместимость рюкзака), а суммарная стоимость была максимальна. 


### Оценка сложности задачи о рюкзаке
Задача о рюкзаке является NP-полной задачей. Это означает, что не существует известного алгоритма, который мог бы решить эту задачу за полиномиальное время.

Полный перебор для решения задачи о рюкзаке имеет экспоненциальную сложность. Это связано с тем, что для каждого предмета есть два варианта - включить его в рюкзак или нет. Таким образом, для n предметов количество возможных комбинаций будет 2<sup>n</sup>, что делает полный перебор непрактичным для больших значений n.

Метод ветвей и границ может значительно сократить количество рассматриваемых решений по сравнению с полным перебором, он все равно может быть довольно затратным в плане времени и памяти, особенно для больших задач. В худшем случае метод ветвей и границ может привести к полному перебору всех возможных комбинаций, что дает экспоненциальную сложность O(2<sup>n</sup>), где n - количество предметов. Это происходит, когда невозможно отсечь ни одну ветвь и приходится исследовать все возможные подмножества предметов.


# Генетический алгоритм
Генетический алгоритм — это метод оптимизации и поиска решений, который использует принципы генетики и естественного отбора. Он может быть использован для нахождения приближенного решения задач, для которых нет эффективного алгоритма, в том числе для задачи о рюкзаке и задачи коммивояжера.

Основные шаги генетического алгоритма:
- Инициализация: Создается начальная популяция случайных решений (особей).
- Оценка: Каждое решение оценивается с помощью функции приспособленности (фитнес функция), которая измеряет качество решения.
- Отбор: На основе оценки приспособленности выбираются решения, которые будут использоваться для создания нового поколения. Чем выше приспособленность, тем больше шансов у решения быть выбранным.
- Кроссовер (скрещивание): Выбранные решения комбинируются для создания новых решений. Это может происходить различными способами, но обычно включает в себя обмен частями двух решений.
- Мутация: С небольшой вероятностью некоторые части новых решений случайным образом изменяются для добавления вариативности.
- Новое поколение: Новые решения заменяют старые, и процесс повторяется с шага оценки.

Этот процесс продолжается до тех пор, пока не будет достигнут критерий остановки, например, максимальное количество поколений или достижение достаточно хорошего решения.

## Задача коммивояжера

### Постановка задачи
Есть N городов, связанных дорогами. Расстояния между городами известны. Коммивояжер (бродячий торговец) должен выйти из первого города, посетить по одному разу в некотором порядке города 2,3..n и вернуться в первый город. В каком порядке следует посещать города, чтобы замкнутый путь коммивояжера имел кратчайшее расстояние?

### Вариант №1

#### Постановка задачи

Используем Генетический алгоритм для задачи коммивояжера.

Для условий 1 варианта задания 12:

1. Сгенерировать 2 особи (случайных решения) в виде перестановки номеров городов, которая всегда начинается с единицы.
2. Рассчитать фитнес-функцию для особей.
3. Закодировать их с применением альтернативной кодировки с пошаговыми комментариями.
4. Провести одноточечное скрещивание особей с пошаговыми комментариями, получить два потомка.
5. Провести мутацию одного из потомков с пошаговыми комментариями.
6. Декодировать альтернативную кодировку потомков в натуральную кодировку с пошаговыми комментариями.
7. Рассчитать фитнес-функцию для потомков.

#### Матрица расстояний

|   | 1 | 2 | 3 | 4 | 5 |
|---|---|---|---|---|---|
| 1 | ∞ | 5 | 10| 8 | 10|
| 2 | 12| ∞ | 13| 9 | 8 |
| 3 | 10| 8 | ∞ | 15| 10|
| 4 | 5 | 7 | 13| ∞ | 7 |
| 5 | 14| 10| 10| 11| ∞ |

#### Создание особей

Для создания особей генерируется рандомный порядок вершин, который всегда начинается с 1.
$$
X_1 = 13245
X_2 = 15243
$$

#### Рассчитаем для двух первых особей фитнес-функции

Для данной задачи фитнес-функция - сумма стоимости ребёр в цикле.
Алгоритм должен минимизировать эту сумму

$$
X_1 = 10 + 8 + 9 + 7 + 14 = 48
x_2 = 10 + 10 + 9 + 13 + 10 = 52
$$

#### Скрещивание

Для скрещивания необходима альтернативная кодировка, чтобы избежать повторения вершин или отсутствие одной из них в коде особи.

Для кодировки нужно 3 множества: исходное множество вершин (натуральный код особи), множество всех вершин в графе, отсортированных по возрастанию, и множество их порядковых номеров.
Для каждой вершины из цикла находим ее в отсортированном множестве вершин и записываем ее номер в альтернативную кодировку. После этого удаляем вершину из отсортированного множества и проводим перерасчет позиций.

Рассчитаем альтернативный код для Первой особи:

|  1                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 3 | 2 | 4 | 5 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |
| альтернативный код               |   |   |   |   |   |

Вершина 1 имеет номер 1

|  1                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 3 | 2 | 4 | 5 |
| возрастающая перестановка        |   | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки |   | 1 | 2 | 3 | 4 |
| альтернативный код               | 1 |   |   |   |   |

Вершина 3 имеет номер 2

|  1                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 3 | 2 | 4 | 5 |
| возрастающая перестановка        |   | 2 |   | 4 | 5 |
| номера возрастающей перестановки |   | 1 |   | 2 | 3 |
| альтернативный код               | 1 | 2 |   |   |   |

Вершина 2 имеет номер 1

|  1                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 3 | 2 | 4 | 5 |
| возрастающая перестановка        |   |   |   | 4 | 5 |
| номера возрастающей перестановки |   |   |   | 1 | 2 |
| альтернативный код               | 1 | 2 | 1 |   |   |

Вершина 4 имеет номер 1

|  1                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 3 | 2 | 4 | 5 |
| возрастающая перестановка        |   |   |   |   | 5 |
| номера возрастающей перестановки |   |   |   |   | 1 |
| альтернативный код               | 1 | 2 | 1 | 1 |   |

Вершина 5 имеет номер 1

|  1                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 3 | 2 | 4 | 5 |
| возрастающая перестановка        |   |   |   |   |   |
| номера возрастающей перестановки |   |   |   |   |   |
| альтернативный код               | 1 | 2 | 1 | 1 | 1 |

Альтернативный код для первой особи: **12111**

Рассчитаем альтернативный код для Второй особи:

|  2                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 5 | 2 | 4 | 3 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |
| альтернативный код               |   |   |   |   |   |

Вершина 1 имеет номер 1

|  2                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 5 | 2 | 4 | 3 |
| возрастающая перестановка        |   | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки |   | 1 | 2 | 3 | 4 |
| альтернативный код               | 1 |   |   |   |   |

Вершина 5 имеет номер 4

|  2                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 5 | 2 | 4 | 3 |
| возрастающая перестановка        |   | 2 | 3 | 4 |   |
| номера возрастающей перестановки |   | 1 | 2 | 3 |   |
| альтернативный код               | 1 | 4 |   |   |   |

Вершина 2 имеет номер 1

|  2                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 5 | 2 | 4 | 3 |
| возрастающая перестановка        |   |   | 3 | 4 |   |
| номера возрастающей перестановки |   |   | 1 | 2 |   |
| альтернативный код               | 1 | 4 | 1 |   |   |

Вершина 4 имеет номер 2

|  2                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 5 | 2 | 4 | 3 |
| возрастающая перестановка        |   |   | 3 |   |   |
| номера возрастающей перестановки |   |   | 1 |   |   |
| альтернативный код               | 1 | 4 | 1 | 2 |   |

Вершина 3 имеет номер 1

|  2                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 5 | 2 | 4 | 3 |
| возрастающая перестановка        |   |   |   |   |   |
| номера возрастающей перестановки |   |   |   |   |   |
| альтернативный код               | 1 | 4 | 1 | 2 | 1 |

Альтернативный код для первой особи: **14121**

#### Одноточечное скрещивание

Проведём одноточечное скрещивание с 4 позиции: поменяем местами значения 4 и 5 позиции хромосом.

|    |   |   |   |   |   |
|----|---|---|---|---|---|
| X1 | 1 | 2 | 1 | 1 | 1 |
| X2 | 1 | 4 | 1 | 2 | 1 |
| X3 | 1 | 2 | 1 | 2 | 1 |
| X4 | 1 | 4 | 1 | 1 | 1 |

#### Мутация

Для мутации потомка можно заменить одну цифру в альтернативном коде особи на любую другую из допустимых значений.

Мутируем потомка X<sub>4</sub> в 3 позиции.
Для 3 позиции допустимы значения от 1 до n-i+1.
То есть значения: 1, 2, 3.

Заменим 1 на 2:

|    |   |   |   |   |   |
|----|---|---|---|---|---|
| X1 | 1 | 2 | 1 | 1 | 1 |
| X2 | 1 | 4 | 1 | 2 | 1 |
| X3 | 1 | 2 | 1 | 2 | 1 |
| X4 | 1 | 4 | 2 | 1 | 1 |

#### Декодирование

Для декодирования нужны 3 множества: альтернативная кодировка особи, множество всех вершин в графе, отсортированных по возрастанию, и множество их порядковых номеров.
Для каждого номера из альтернативной кодировки находим его в номерах отсортированных вершин и записываем соответствующую вершину в натуральную кодировку. После этого удаляем вершину из отсортированного множества и проводим перерасчет позиций.

Рассчитаем натуральный код для Третьей особи:

|  3                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 2 | 1 | 2 | 1 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |
| натуральный код                  |   |   |   |   |   |

Номеру 1 соответствует вершина 1

|  3                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 2 | 1 | 2 | 1 |
| возрастающая перестановка        |   | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки |   | 1 | 2 | 3 | 4 |
| натуральный код                  | 1 |   |   |   |   |

Номеру 2 соответствует вершина 3

|  3                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 2 | 1 | 2 | 1 |
| возрастающая перестановка        |   | 2 |   | 4 | 5 |
| номера возрастающей перестановки |   | 1 |   | 2 | 3 |
| натуральный код                  | 1 | 3 |   |   |   |

Номеру 1 соответствует вершина 2

|  3                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 2 | 1 | 2 | 1 |
| возрастающая перестановка        |   |   |   | 4 | 5 |
| номера возрастающей перестановки |   |   |   | 1 | 2 |
| натуральный код                  | 1 | 3 | 2 |   |   |

Номеру 2 соответствует вершина 5

|  3                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 2 | 1 | 2 | 1 |
| возрастающая перестановка        |   |   |   | 4 |   |
| номера возрастающей перестановки |   |   |   | 1 |   |
| натуральный код                  | 1 | 3 | 2 | 5 |   |

Номеру 1 соответствует вершина 4

|  3                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 2 | 1 | 2 | 1 |
| возрастающая перестановка        |   |   |   |   |   |
| номера возрастающей перестановки |   |   |   |   |   |
| натуральный код                  | 1 | 3 | 2 | 5 | 4 |

Натуральный код для третьей особи: **13254**

Рассчитаем натуральный код для Четвёртой особи:

|  4                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |
| натуральный код                  |   |   |   |   |   |

Номеру 1 соответствует вершина 1

|  4                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        |   | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки |   | 1 | 2 | 3 | 4 |
| натуральный код                  | 1 |   |   |   |   |

Номеру 4 соответствует вершина 5

|  4                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        |   | 2 | 3 | 4 |   |
| номера возрастающей перестановки |   | 1 | 2 | 3 |   |
| натуральный код                  | 1 | 5 |   |   |   |

Номеру 2 соответствует вершина 3

|  4                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        |   | 2 |   | 4 |   |
| номера возрастающей перестановки |   | 1 |   | 2 |   |
| натуральный код                  | 1 | 5 | 3 |   |   |

Номеру 1 соответствует вершина 2

|  4                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        |   |   |   | 4 |   |
| номера возрастающей перестановки |   |   |   | 1 |   |
| натуральный код                  | 1 | 5 | 3 | 2 |   |

Номеру 1 соответствует вершина 4

|  4                               |   |   |   |   |   |  
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        |   |   |   |   |   |
| номера возрастающей перестановки |   |   |   |   |   |
| натуральный код                  | 1 | 5 | 3 | 2 | 4 |

Натуральный код для первой особи: **15324**

#### Рассчитаем фитнес-функции для потомков

$$
X_3 = 10 + 8 + 8 + 11 + 5 = 42
X_4 = 10 + 10 + 8 + 9 + 5 = 42
$$