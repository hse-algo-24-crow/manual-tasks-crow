# Задание №13
# Задача о рюкзаке (Knapsack problem). Генетический алгоритм.

## Задание
Для каждого варианта представлены условия задачи, в соответствии с которыми необходимо: 
1. Решить задачу о рюкзаке с применением генетического алгоритма.
2. Оформить решение задачи по шагам с подробными комментариями, таблицами и диаграммами.
3. В ответе указать:
   - максимально возможную стоимость предметов в рюкзаке,
   - набор предметов, обеспечивающих максимальную стоимость,
   - общий вес предметов в рюкзаке,
   - свободное место в рюкзаке.

**Генетический алгоритм не гарантирует получение точного решения, при выполнении задания важно продемонстрировать понимание работы алгоритма, а не получение точного решения.**

## Постановка задачи
Задача о рюкзаке (англ. Knapsack problem) — дано N предметов, n<sub>i</sub> предмет имеет массу w<sub>i</sub> > 0 и стоимость p<sub>i</sub> > 0. Необходимо выбрать из этих предметов такой набор, чтобы суммарная масса не превосходила заданной величины W (вместимость рюкзака), а суммарная стоимость была максимальна. 


### Оценка сложности задачи о рюкзаке
Задача о рюкзаке является NP-полной задачей. Это означает, что не существует известного алгоритма, который мог бы решить эту задачу за полиномиальное время.

Полный перебор для решения задачи о рюкзаке имеет экспоненциальную сложность. Это связано с тем, что для каждого предмета есть два варианта - включить его в рюкзак или нет. Таким образом, для n предметов количество возможных комбинаций будет 2<sup>n</sup>, что делает полный перебор непрактичным для больших значений n.

Метод ветвей и границ может значительно сократить количество рассматриваемых решений по сравнению с полным перебором, он все равно может быть довольно затратным в плане времени и памяти, особенно для больших задач. В худшем случае метод ветвей и границ может привести к полному перебору всех возможных комбинаций, что дает экспоненциальную сложность O(2<sup>n</sup>), где n - количество предметов. Это происходит, когда невозможно отсечь ни одну ветвь и приходится исследовать все возможные подмножества предметов.


# Генетический алгоритм
Генетический алгоритм — это метод оптимизации и поиска решений, который использует принципы генетики и естественного отбора. Он может быть использован для нахождения приближенного решения задач, для которых нет эффективного алгоритма, в том числе для задачи о рюкзаке и задачи коммивояжера.

Основные шаги генетического алгоритма:
- Инициализация: Создается начальная популяция случайных решений (особей).
- Оценка: Каждое решение оценивается с помощью функции приспособленности (фитнес функция), которая измеряет качество решения.
- Отбор: На основе оценки приспособленности выбираются решения, которые будут использоваться для создания нового поколения. Чем выше приспособленность, тем больше шансов у решения быть выбранным.
- Кроссовер (скрещивание): Выбранные решения комбинируются для создания новых решений. Это может происходить различными способами, но обычно включает в себя обмен частями двух решений.
- Мутация: С небольшой вероятностью некоторые части новых решений случайным образом изменяются для добавления вариативности.
- Новое поколение: Новые решения заменяют старые, и процесс повторяется с шага оценки.

Этот процесс продолжается до тех пор, пока не будет достигнут критерий остановки, например, максимальное количество поколений или достижение достаточно хорошего решения.

## Постановка задачи

### Вариант №4

Решить задачу о рюкзаке с применением генетического алгоритма, с учетом следующих требований:

- Придумать условия задачи с количеством предметов не менее 6.
- Численность популяции не менее 4 особей, в скрещивании участвует половина популяции.
- Для скрещивания выбираются особи по принципу рулетки, скрещивание – равномерное.
- До выполнения алгоритма сформулировать стратегию применения оператора мутации.
- Сформировать не менее 3 поколений, не считая первоначального.

### Составим условие задачи

|**Предметы**|**A**|**B**|**C**|**D**|**E**|**F**|
|:-----------|:---:|:---:|:---:|:---:|:---:|:---:|
| Стоимость  |  5  |  6  |  3  |  8  |  6  |  7  |
| Вес        |  10 |  2  |  12 |  4  |  6  |  5  |

Максимальный вес W = 26

Стратегия применения оператора мутации:
С вероятностью 0.2 инвертировать ген E (5 позицию) потомка. Для каждого потомка случайным образом генерируется число от 1 до 10, если оно меньше или равно 2 - происходит мутация.

Алгоритм останавливается на 4 поколении.

### Решение

#### Поколение 1

Сгенерируем 4 варианта компоновки рюкзака. Случайным образом составим шестизначные комбинации (хромосомы) из нулей и единиц, где 1 обозначает "берём предмет", 0 - "не берём"

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|
|   1     |  1  |  1  |  0  |  0  |  0  |  1  |
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |
|   3     |  1  |  0  |  1  |  0  |  1  |  0  |
|   4     |  0  |  1  |  1  |  1  |  0  |  0  |

Чтобы оценить жизнеспособность особей, посчитаем вес получившихся рюкзаков. Заметим, что у одной особи вес рюкзака превышает максимальное значение - следовательно, она не жизнеспособна, и процедуру генерации для неё нужно провести заново.

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   1     |  1  |  1  |  0  |  0  |  0  |  1  |  17  |
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  15  |
|   3     |  1  |  0  |  1  |  0  |  1  |  0  |**28**|
|   4     |  0  |  1  |  1  |  1  |  0  |  0  |  18  |

Сгенерируем заново особь 3:

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   1     |  1  |  1  |  0  |  0  |  0  |  1  |  17  |
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  15  |
|   3     |  1  |  0  |  0  |  1  |  1  |  0  |  20  |
|   4     |  0  |  1  |  1  |  1  |  0  |  0  |  18  |

В популяции нет нежизнеспособных особей - все веса в пределах допустимого значения.

#### Поколение 2

Посчитаем стоимость получившихся рюкзаков

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**Cost**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:------:|:----:|
|   1     |  1  |  1  |  0  |  0  |  0  |  1  |  18    |  17  |
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  21    |  15  |
|   3     |  1  |  0  |  0  |  1  |  1  |  0  |  19    |  20  |
|   4     |  0  |  1  |  1  |  1  |  0  |  0  |  17    |  18  |

Для реализации принципа рулетки найдём суммарную стоимость рюкзаков и рассчитаем, какую часть от общей стоимости составляет каждый рюкзак (точность до 3 знаков после запятой).
Присвоим для каждого рюкзака интервал (в границах от 1 до 1000), пропорциональный его стоимости, и сгенерируем 2 числа от 1 до 1000.
Выберем тех особей, в интервал которых попали эти 2 случайных числа.

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**Cost**|**%** |**Интервал**|
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:------:|:----:|:----------:|
|   1     |  1  |  1  |  0  |  0  |  0  |  1  |  18    | 0,24 |    1-240   |
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  21    | 0,28 |  241-520   |
|   3     |  1  |  0  |  0  |  1  |  1  |  0  |  19    | 0,253|  521-773   |
|   4     |  0  |  1  |  1  |  1  |  0  |  0  |  17    | 0,227|  774-1000  |

Случайным образом получились два числа: 
- **986**
- **219**

В этом случае выбираем особей 4 и 1.

Проведём равномерное скрещивание - каждый ген одного родителя с вероятностью 0,5 меняется с соответвующим геном другого родителя. В нашем случае генератор случайных выбрал для перестановки гены: B, C, F.

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   1     |  1  |  1  |  0  |  0  |  0  |  1  |  17  |
|   4     |  0  |  1  |  1  |  1  |  0  |  0  |  18  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  24  |
|   6     |  0  |  1  |  0  |  1  |  0  |  1  |  11  |

Проведём мутацию в соответствии с условием.
Сгенерируем 2 числа от 1 до 10:
- 7
- 1

Первый потомок не подвергается мутации (7 > 2), второй мутирует. Заменим ген E для особи 6 и рассчитаем веса для оценки жизнеспособностим:

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   1     |  1  |  1  |  0  |  0  |  0  |  1  |  17  |
|   4     |  0  |  1  |  1  |  1  |  0  |  0  |  18  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  24  |
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  17  |

В популяции нет нежизнеспособных особей (все веса в пределах допустимого значения).

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  15  |
|   3     |  1  |  0  |  0  |  1  |  1  |  0  |  20  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  24  |
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  17  |

#### Поколение 3

Оценим стоимости получившихся рюкзаков:

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**Cost**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:------:|:----:|
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  21    |  15  |
|   3     |  1  |  0  |  0  |  1  |  1  |  0  |  19    |  20  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  14    |  24  |
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  27    |  17  |

Реализуем принцип рулетки, аналогично поколению 1:

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**Cost**|**%** |**Интервал**|
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:------:|:----:|:----------:|
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  21    | 0,259 |  1-259   |
|   3     |  1  |  0  |  0  |  1  |  1  |  0  |  19    | 0,235|  260-494   |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  14    | 0,173|  495-667  |
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  27    | 0,333|  668-1000  |

Случайным образом получились два числа: 
- **107**
- **287**

В этом случае выбираем особей 2 и 3.

Проведём равномерное скрещивание.
В этом случае генератор случайных чисел выбрал для перестановки гены: B, D, F.

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   2     |  0  |  0  |  0  |  1  |  1  |  1  |  15  |
|   3     |  1  |  0  |  0  |  1  |  1  |  0  |  20  |
|   7     |  0  |  0  |  0  |  1  |  1  |  0  |  10  |
|   8     |  1  |  0  |  0  |  1  |  1  |  1  |  25  |

Проведём мутацию в соответствии с условием.
Сгенерируем 2 числа от 1 до 10:
- 7
- 10

Ни один потомок не мутирует.

В популяции нет нежизнеспособных особей (все веса в пределах допустимого значения).

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   7     |  0  |  0  |  0  |  1  |  1  |  0  |  10  |
|   8     |  1  |  0  |  0  |  1  |  1  |  1  |  25  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  24  |
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  17  |

#### Поколение 4

Оценим стоимость получившихся рюкзаков:

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**Cost**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:------:|:----:|
|   7     |  0  |  0  |  0  |  1  |  1  |  0  |  14    |  10  |
|   8     |  1  |  0  |  0  |  1  |  1  |  1  |  26    |  25  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  14    |  24  |
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  27    |  17  |

Реализуем принцип рулетки аналогично полокению 1:

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**Cost**|**%** |**Интервал**|
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:------:|:----:|:----------:|
|   7     |  0  |  0  |  0  |  1  |  1  |  0  |  14    | 0,173 |  1-173   |
|   8     |  1  |  0  |  0  |  1  |  1  |  1  |  26    | 0,321|  174-494   |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  14    | 0,173|  495-667  |
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  27    | 0,333|  668-1000  |

Случайным образом получились два числа: 
- **192**
- **879**

В этом случае выбираем особей 8 и 6.

Проведём равномерное скрещивание.
В этом случае генератор случайных чисел выбрал для перестановки гены: A, B, D, F.

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   6     |  0  |  1  |  0  |  1  |  1  |  1  |  17  |
|   8     |  1  |  0  |  0  |  1  |  1  |  1  |  25  |
|   9     |  1  |  0  |  0  |  1  |  1  |  1  |  25  |
|   10    |  0  |  1  |  0  |  1  |  1  |  1  |  17  |

Проведём мутацию в соответствии с условием.
Сгенерируем 2 числа от 1 до 10:
- 3
- 6

Ни один потомок не мутирует.

В популяции нет нежизнеспособных особей (все веса в пределах допустимого значения).

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:----:|
|   9     |  1  |  0  |  0  |  1  |  1  |  1  |  25  |
|   10    |  0  |  1  |  0  |  1  |  1  |  1  |  17  |
|   7     |  0  |  0  |  0  |  1  |  1  |  0  |  10  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  24  |

Достигнуто 4 поколения - условие остановки алгоритма.

Выберем самый ценный рюкзак и рассчитаем стоимость для каждого рюкзака:

|**Особи**|**A**|**B**|**C**|**D**|**E**|**F**|**Cost**|**W** |
|:--------|:---:|:---:|:---:|:---:|:---:|:---:|:------:|:----:|
|   9     |  1  |  0  |  0  |  1  |  1  |  1  |  26    |  25  |
|   10    |  0  |  1  |  0  |  1  |  1  |  1  |  27    |  17  |
|   7     |  0  |  0  |  0  |  1  |  1  |  0  |  14    |  10  |
|   5     |  1  |  1  |  1  |  0  |  0  |  0  |  14    |  24  |

Особь 10 представляет из себя самый лучший вариант компоновки рюкзака.

### Ответ

Максимальная стоимость предметов: 27.
Набор предметов для максимальной стоимости: B, D, E, F.
Общий вес: 17.
Свободное место: 9.
