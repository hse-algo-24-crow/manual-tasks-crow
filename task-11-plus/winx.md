## Транспортная задача
### Вариант 3:

Два завода имеют производительность 7 и 10, а два складских помещения имеют вместимость 8 и 11. Матрица затрат на перевозку одной единицы товара (строки – это заводы, столбцы – это склады) имеет вид:

$$
 \begin{pmatrix}    
  3 & 5 \\ 
  1 & 4 \\ 
 \end{pmatrix}    
$$

Требуется:
1. Найти стоимость перевозки с первого завода на первый склад 7 единиц товара, а со второго завода на второй склад 8 единиц товара;
2. Используя алгоритм поиска максимального потока минимальной стоимости, скорректировать указанный выше вариант перевозки товаров, так чтобы объём перевозимых товаров не изменился, а стоимость их перевозки стала минимальной.

Рассмотрим произвольный вариант доставки всей продукции и вычислим его стоимость. стоимость. Пусть, например, с завода А на первый склад доставляется 5 единиц продукции, а на второй - 2 единицы; с завода В на первый склад - 3 единицы продукции, а на второй склад - 7 единиц продукции. 

Изобразим в виде двудольного графа:

```mermaid
graph LR
    A-->|7,7|1
    A-->|0,7|2
    B-->|0,10|1
    B-->|8,10|2
```
### 1. Добавим в полученный двудольный граф источник s и сток t.

```mermaid
graph LR
    A-->|7,7|1
    A-->|0,7|2
    B-->|0,10|1
    B-->|8,10|2
    s-->|7,7|A
    s-->|8,10|B
    1-->|7,8|t
    2-->|8,11|t
```

На дугах сети указаны пары чисел, где первое число - локальный поток, второе число - пропускная способность. Локальный поток в данном случае был выбран ранее наугад. 

### 2. Рассчитаем стоимость полученного максимального потока.

|          Дуги            | sa | sb | a1 | a2 | b1 | b2 | 1t | 2t |  Итого  |
|:------------------------:|:--:|:--:|----|:--:|:--:|:--:|:--:|:--:|:-------:|
| Пропускная способность   | 7  | 10 | 7  | 7  | 10 | 10 | 8  | 11 |         |
| Локальный поток f(e)     | 7  |  8 | 7  | 0  | 0  | 8  | 7  |  8 |         |
| Стоимость транспортировки| 0  | 0  | 3  | 5  | 1  | 4  | 0  | 0  |         |
| Суммарная стоимость f(e)*c(e) | 0 | 0 | 21 | 0 | 0 | 32 | 0  | 0| **53** |

Стоимость полученного потока составляет 53. 

### 3. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Остаточная сеть:

```mermaid
graph RL
    s--->|7|a
    s--->|8|b
    b-.->|2|s
    a--->|7|1
    b--->|8|2
    2-.->|2|b
    2-.->|7|a
    1-.->|10|b
    1--->|7|t
    2--->|8|t
    t-.->|3|2
    t-.->|1|1
```


Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph RL
    s--->|0|a
    s--->|0|b
    b-.->|0|s
    a--->|-3|1
    b--->|-4|2
    2-.->|4|b
    2-.->|5|a
    1-.->|1|b
    1--->|0|t
    2--->|0|t
    t-.->|0|2
    t-.->|0|1
```

В остаточной сети найден ориентированный цикл отрицательной стоимости a -> 1 -> b -> 2 -> a (- 3 + 1 - 4 + 5 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph RL
    s--->|7|a
    s--->|8|b
    b-.->|2|s
    a--->|7|1
    b--->|8|2
    2-.->|2|b
    2-.->|7|a
    1-.->|10|b
    1--->|7|t
    2--->|8|t
    t-.->|3|2
    t-.->|1|1
```

Минимальный вес ребра в цикле 7 - это неиспользованный резерв ребра a -> 1.

Удалим найденный цикл - уменьшим на 7 вес всех ребер, входящих в цикл.

```mermaid
graph RL
    s--->|7|a
    s--->|8|b
    b-.->|2|s
    1-.->|7|a
    b--->|1|2
    2-.->|9|b
    a--->|7|2
    1-.->|3|b
    b--->|7|1
    1--->|7|t
    2--->|8|t
    t-.->|3|2
    t-.->|1|1
```

Изменим граф со стоимостями транспортировки:

```mermaid
graph RL
    s--->|0|a
    s--->|0|b
    b-.->|0|s
    a--->|-3|1
    b--->|-4|2
    b--->|-1|1
    2-.->|4|b
    1-.->|1|b
    1-.->|3|a
    1--->|0|t
    2--->|0|t
    t-.->|0|2
    t-.->|0|1
```

### 4. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph RL
    s--->|0|a
    s--->|0|b
    b-.->|0|s
    1-.->|3|a
    b--->|-4|2
    2-.->|4|b
    a--->|-5|2
    1-.->|1|b
    b--->|-1|1
    1--->|0|t
    2--->|0|t
    t-.->|0|2
    t-.->|0|1
```

В остаточной сети найден ориентированный цикл отрицательной стоимости s -> a -> 2 -> b -> s (0 - 5 + 4 + 0 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**. 

```mermaid
graph RL
    s--->|7|a
    s--->|8|b
    b-.->|2|s
    1-.->|7|a
    b--->|1|2
    2-.->|9|b
    a--->|7|2
    1-.->|3|b
    b--->|7|1
    1--->|7|t
    2--->|8|t
    t-.->|3|2
    t-.->|1|1
```

Минимальный вес ребра в цикле 2 - это неиспользованный резерв ребра b -> s.

Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

```mermaid
graph RL
    s--->|5|a
    a-.->|2|s
    s--->|10|b
    1-.->|7|a
    b--->|3|2
    2-.->|7|b
    a--->|5|2
    2-.->|2|a
    1-.->|3|b
    b--->|7|1
    1--->|7|t
    2--->|8|t
    t-.->|3|2
    t-.->|1|1
```

Изменим граф со стоимостями транспортировки:

```mermaid
graph RL
    s--->|0|a
    a-.->|0|s
    s--->|0|b
    1-.->|3|a
    b--->|-4|2
    2-.->|4|b
    a--->|-5|2
    2-.->|5|a
    1-.->|1|b
    b--->|-1|1
    1--->|0|t
    2--->|0|t
    t-.->|0|2
    t-.->|0|1
```

В остаточной сети найден ориентированный цикл отрицательной стоимости a -> 2 -> t -> 1 -> a (-5 + 0 + 0 + 3 = -2). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**. 

```mermaid
graph RL
    s--->|5|a
    a-.->|2|s
    s--->|10|b
    1-.->|7|a
    b--->|3|2
    2-.->|7|b
    a--->|5|2
    2-.->|2|a
    1-.->|3|b
    b--->|7|1
    1--->|7|t
    2--->|8|t
    t-.->|3|2
    t-.->|1|1
```

Минимальный вес ребра в цикле 1 - это неиспользованный резерв ребра t -> 1.

Удалим найденный цикл - уменьшим на 1 вес всех ребер, входящих в цикл.

```mermaid
graph RL
    s--->|5|a
    a-.->|2|s
    s--->|10|b
    1-.->|6|a
    a-.->|1|1
    b--->|3|2
    2-.->|7|b
    a--->|4|2
    2-.->|3|a
    1-.->|3|b
    b--->|7|1
    1--->|8|t
    2--->|7|t
    t-.->|4|2
```

Изменим граф со стоимостями транспортировки:

```mermaid
graph RL
    s--->|0|a
    a-.->|0|s
    s--->|0|b
    1-.->|3|a
    a-.->|-3|1
    b--->|-4|2
    2-.->|4|b
    a--->|-5|2
    2-.->|5|a
    1-.->|1|b
    b--->|-1|1
    1--->|0|t
    2--->|0|t
    t-.->|0|2
```

В остаточной сети найден ориентированный цикл отрицательной стоимости a -> 1 -> b -> 2 -> a (-3 + 1 - 4 + 5 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**. 

```mermaid
graph RL
    s--->|5|a
    a-.->|2|s
    s--->|10|b
    1-.->|6|a
    a-.->|1|1
    b--->|3|2
    2-.->|7|b
    a--->|4|2
    2-.->|3|a
    1-.->|3|b
    b--->|7|1
    1--->|8|t
    2--->|7|t
    t-.->|4|2
```

Минимальный вес ребра в цикле 1 - это неиспользованный резерв ребра a -> 1.

Удалим найденный цикл - уменьшим на 1 вес всех ребер, входящих в цикл.

```mermaid
graph RL
    s--->|5|a
    a-.->|2|s
    s--->|10|b
    1-.->|7|a
    b--->|2|2
    2-.->|8|b
    a--->|5|2
    2-.->|2|a
    1-.->|2|b
    b--->|8|1
    1--->|8|t
    2--->|7|t
    t-.->|4|2
```

Изменим граф со стоимостями транспортировки:

```mermaid
graph RL
    s--->|0|a
    a-.->|0|s
    s--->|0|b
    1-.->|3|a
    b--->|-4|2
    2-.->|4|b
    a--->|-5|2
    2-.->|5|a
    1-.->|1|b
    b--->|-1|1
    1--->|0|t
    2--->|0|t
    t-.->|0|2
```

В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна. 

### 5. Рассчитаем стоимость полученного максимального потока.

|          Дуги            | sa | sb | a1 | a2 | b1 | b2 | 1t | 2t |  Итого  |
|:------------------------:|:--:|:--:|----|:--:|:--:|:--:|:--:|:--:|:-------:|
| Пропускная способность   | 7  | 10 | 7  | 7  | 10 | 10 | 8  | 11 |         |
| Локальный поток f(e)     | 5  | 10 | 0  | 5  | 8  | 2  | 8  |  7 |         |
| Стоимость транспортировки| 0  | 0  | 3  | 5  | 1  | 4  | 0  | 0  |         |
| Суммарная стоимость f(e)*c(e) | 0 | 0 | 0 | 25 | 8  | 8 | 0  | 0| **41** |

Стоимость полученного потока составляет 41. 

### Ответ:
Максимальный поток в сети равен 10, минимальная стоимость потока 41, она реализуется следующим локальными потоками:

```mermaid
graph LR
    A-->|0,7|1
    A-->|5,7|2
    B-->|8,10|1
    B-->|2,10|2
    s-->|5,7|A
    s-->|10,10|B
    1-->|8,8|t
    2-->|7,11|t
```
