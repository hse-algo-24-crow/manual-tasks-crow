# Задание №10
# Задача о максимальном потоке минимальной стоимости.

## Задание
Для каждого варианта представлены условия задачи, в соответствии с которыми необходимо: 
1. Построить сеть с указанием пропускной способности дуг.
2. Построить остаточную сеть.
3. Определить максимальный поток методом поиска увеличивающих путей в остаточной сети.
4. Минимизировать стоимость максимального потока посредством поиска циклов отрицательной стоимости.
5. Оформить решение задачи по шагам с подробными комментариями, таблицами и диаграммами.
6. В ответе указать максимальную величину потока, минимальную стоимость транспортировки и сеть с указанием соответствующих локальных потоков.

## Постановка задачи
1. Дана сеть (взвешенный ориентированный граф) с источником s и стоком t.
2. Для каждой дуги определена пропускная способность и стоимость транспортировки.
3. Необходимо найти для указанной сети максимальный поток минимальной стоимости. 

## Вариант №7

Пропускная способность дуг сети и стоимость транспортировки указана в таблице.

| Дуги                                          | sa | sb | sc | ac | ad | ab | bd | ct | dt |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность p(e)                   | 9  | 9  | 4  | 6  | 7  | 4  | 7  | 9  | 9  |
| Стоимость транспортировки единицы потока c(e) | 2  | 2  | 7  | 3  | 4  | 2  | 2  | 5  | 2  |

### Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг для поиска максимального потока.

```mermaid
graph LR
    s-->|9|a
    s-->|9|b
    s-->|4|c
    a-->|6|c
    a-->|7|d
    a-->|4|b
    b-->|7|d
    c-->|9|t
    d-->|9|t
```
Построим соответствующую остаточную сеть.

```mermaid
graph RL
    a-.->|9|s
    b-.->|9|s
    c-.->|4|s
    c-.->|6|a
    d-.->|7|a
    b-.->|4|a
    d-.->|7|b
    t-.->|9|c
    t-.->|9|d
```

### Проведем поиск увеличивающего пути в остаточной сети

В остаточной сети найден произвольный увеличивающий путь:
t -> d -> a -> s. 

Минимальный вес дуг на этом пути: 7.

Уменьшим вес дуг на найденном пути.
Дуги для которых вес стал нулевым - дуга da - удалим из остаточной сети.

```mermaid
graph RL
    s--->|7|a
    a-.->|2|s
    b-.->|9|s
    c-.->|4|s
    c-.->|6|a
    a--->|7|d
    b-.->|4|a
    d-.->|7|b
    t-.->|9|c
    d--->|7|t
    t-.->|2|d
```

### Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети найден произвольный увеличивающий путь:
t -> c -> s. 

Минимальный вес дуг на этом пути: 4.

Уменьшим вес дуг на найденном пути.
Дуги для которых вес стал нулевым - дуга cs - удалим из остаточной сети.

```mermaid
graph RL
    s--->|7|a
    a-.->|2|s
    b-.->|9|s
    s--->|4|c
    c-.->|6|a
    a--->|7|d
    b-.->|4|a
    d-.->|7|b
    c--->|4|t
    t-.->|5|c
    d--->|7|t
    t-.->|2|d
```

### Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети найден произвольный увеличивающий путь:
t -> d -> b -> s. 

Минимальный вес дуг на этом пути: 2.

Уменьшим вес дуг на найденном пути.
Дуги для которых вес стал нулевым - дуга td - удалим из остаточной сети.

```mermaid
graph RL
    s--->|7|a
    a-.->|2|s
    s--->|2|b
    b-.->|7|s
    s--->|4|c
    c-.->|6|a
    a--->|7|d
    b-.->|4|a
    b--->|2|d
    d-.->|5|b
    c--->|4|t
    t-.->|5|c
    d--->|9|t
```

### Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети найден произвольный увеличивающий путь:
t -> c -> a -> s. 

Минимальный вес дуг на этом пути: 2.

Уменьшим вес дуг на найденном пути.
Дуги для которых вес стал нулевым - дуга as - удалим из остаточной сети.

```mermaid
graph RL
    s--->|9|a
    s--->|2|b
    b-.->|7|s
    s--->|4|c
    a--->|2|c
    c-.->|4|a
    a--->|7|d
    b-.->|4|a
    b--->|2|d
    d-.->|5|b
    c--->|6|t
    t-.->|3|c
    d--->|9|t
```

### Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети найден произвольный увеличивающий путь:
t -> c -> a -> d -> b -> s. 

Минимальный вес дуг на этом пути: 3.

Важно учесть, что пусть проходит через дугу ad с нулевым резервом. Ещё один поток через неё провести нельзя. Значит, придётся корректировать величину других потоков.

Уменьшим вес дуг на найденном пути.
Дуги для которых вес стал нулевым - дуга tc - удалим из остаточной сети.

```mermaid
graph RL
    s--->|9|a
    s--->|5|b
    b-.->|4|s
    s--->|4|c
    a--->|5|c
    c-.->|1|a
    a--->|4|d
    d-.->|3|a
    b-.->|4|a
    b--->|5|d
    d-.->|2|b
    c--->|9|t
    d--->|9|t
```

Скорректируем величину потоков, проходящих через вершину a, с учётом изменения в ребре ad.
Уменьшим один поток на 3 единицы, и увеличим другой на 3:
- s - a - d - t = 7 - 3 = 4
- s - a - c - t = 2 + 3 = 5

Увеличивающих путей больше не найден. Поток максимален.
Величины локальных потоков:
- s - a - d - t = 4
- s - c - t = 4
- s - b - d - t = 5
- s - a - c - t = 5

Отобразим локальные потоки.

```mermaid
graph LR
    s-->|"(9, 9)"|a
    s-->|"(5, 9)"|b
    s-->|"(4, 4)"|c
    a-->|"(5, 6)"|c
    a-->|"(4, 7)"|d
    b-->|"(5, 7)"|d
    c-->|"(9, 9)"|t
    d-->|"(9, 9)"|t
```

Величина потока:
$$
4 + 4 + 5 + 5 = 18
$$

### Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ac | ad | ab | bd | ct | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 9  | 9  | 4  | 6  | 7  | 4  | 7  | 9  | 9  |        |
| Локальный поток f(e)                          | 9  | 5  | 4  | 5  | 4  | 0  | 5  | 9  | 9  |        |
| Стоимость транспортировки единицы потока c(e) | 2  | 2  | 7  | 3  | 4  | 2  | 2  | 5  | 2  |        |
| Суммарная стоимость f(e)*c(e)                 | 18 | 10 | 28 | 15 | 16 | 0  | 10 | 45 | 18 |**160** |

Стоимость полученного потока составляет 160. 

### Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s--->|-2|a
    s--->|-2|b
    b-.->|2|s
    s--->|-7|c
    a--->|-3|c
    c-.->|3|a
    a--->|-4|d
    d-.->|4|a
    b-.->|2|a
    b--->|-2|d
    d-.->|2|b
    c--->|-5|t
    d--->|-2|t
```

В остаточной сети найдём ориентированный цикл отрицательной стоимости:
s -> c -> a -> d -> b -> s
$$
-7 + 3 - 4 + 2 = -4 
$$

Найдем минимальный вес ребра в указанном цикле, изображенном в остаточной сети с указанием величины потока.  

```mermaid
graph LR
    s--->|9|a
    s--->|5|b
    b-.->|4|s
    s--->|4|c
    a--->|5|c
    c-.->|1|a
    a--->|4|d
    d-.->|3|a
    b-.->|4|a
    b--->|5|d
    d-.->|2|b
    c--->|9|t
    d--->|9|t
```

Минимальный вес ребра в цикле: 1 
Это неиспользованный резерв ребра a -> c.

Удалим найденный цикл - уменьшим на 1 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    s--->|9|a
    s--->|6|b
    b-.->|3|s
    s--->|3|c
    c-.->|1|s
    a--->|3|d
    a--->|6|c
    d-.->|4|a
    b-.->|4|a
    b--->|6|d
    d-.->|1|b
    c--->|9|t
    d--->|9|t
```
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s--->|-2|a
    s--->|-2|b
    b-.->|2|s
    s--->|-7|c
    c-.->|7|s
    a--->|-3|c
    a--->|-4|d
    d-.->|4|a
    b-.->|2|a
    b--->|-2|d
    d-.->|2|b
    c--->|-5|t
    d--->|-2|t
```

### Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.

В остаточной сети найдём ориентированный цикл отрицательной стоимости:
s -> a -> d -> b -> s
$$
-2 - 4 + 2 + 2 = -2 
$$

Минимальный вес ребра в цикле: 1 
Это неиспользованный резерв ребра b -> d.

Удалим найденный цикл - уменьшим на 1 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    s--->|8|a
    a-.->|1|s
    s--->|7|b
    b-.->|2|s
    s--->|3|c
    c-.->|1|s
    a--->|6|c
    a--->|2|d
    d-.->|5|a
    b-.->|4|a
    b--->|7|d
    c--->|9|t
    d--->|9|t
```

Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.


```mermaid
graph LR
    s--->|-2|a
    a-.->|-2|s
    s--->|-2|b
    b-.->|2|s
    s--->|-7|c
    c-.->|7|s
    a--->|-3|c
    a--->|-4|d
    d-.->|4|a
    b-.->|2|a
    b--->|-2|d
    c--->|-5|t
    d--->|-2|t
```

Циклы отрицательной стоимости отсутствуют. Следовательно, стоимость потока минимальна.

### Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ac | ad | ab | bd | ct | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 9  | 9  | 4  | 6  | 7  | 4  | 7  | 9  | 9  |        |
| Локальный поток f(e)                          | 8  | 7  | 3  | 6  | 2  | 0  | 7  | 9  | 9  |        |
| Стоимость транспортировки единицы потока c(e) | 2  | 2  | 7  | 3  | 4  | 2  | 2  | 5  | 2  |        |
| Суммарная стоимость f(e)*c(e)                 | 16 | 14 | 21 | 18 | 8  | 0  | 14 | 45 | 18 |**154** |

Стоимость полученного потока составляет 154. 

### Ответ:
Максимальный поток составляет 18, минимальная стоимость потока 154, она реализуется следующим локальными потоками:

- s -> a -> d -> t = 2
- s -> c -> t = 3
- s -> b -> d -> t = 7
- s -> a -> c -> t = 6

```mermaid
graph LR
    s-->|"(8, 9)"|a
    s-->|"(7, 9)"|b
    s-->|"(3, 4)"|c
    a-->|"(6, 6)"|c
    a-->|"(2, 7)"|d
    b-->|"(7, 7)"|d
    c-->|"(9, 9)"|t
    d-->|"(9, 9)"|t
```
